bundle:
  # Do not modify the below line, this autogenerated field is used by the Databricks backend.
  uuid: 8377dbb1-d201-4fb3-b141-bc3c7e66cf25

  name: fraudulent_account_detection
  
variables:
  catalog_name:
    description: "Unity Catalog name"
    default: "fraud_data"
  schema_name:
    description: "Schema name"
    default: "fraud_account"
  model_name:
    description: "Model registry name"
    default: "catboost_binary_classifier"
  experiment_name:
    description: "MLflow_catboost_fraud_account_detection"
    default: /Users/${workspace.current_user.userName}/${bundle.target}-fraudulent_account_detection-experiment

include:
  - "resources/*.yml"

targets:
  dev:
    mode: development
    workspace:
      host: https://adb-3888568082834443.3.azuredatabricks.net
    variables:
      catalog_name: "fraud_data"
      schema_name: "fraud_account"
    
  staging:
    mode: production
    workspace:
      host: https://adb-3888568082834443.3.azuredatabricks.net
    variables:
      catalog_name: "fraud_data"
      schema_name: "fraud_account"
    
  prod:
    mode: production
    workspace:
      host: https://adb-3888568082834443.3.azuredatabricks.net
    variables:
      catalog_name: "fraud_data"
      schema_name: "fraud_account"

resources:
  jobs:
    fraud_detection_training_job:
      name: "fraud-detection-training-{{bundle.target}}"
      tasks:
        - task_key: "data_preprocessing"
          notebook_task:
            notebook_path: "./notebooks/01_data_preprocessing"
            base_parameters:
              catalog_name: "{{var.catalog_name}}"
              schema_name: "{{var.schema_name}}"
          new_cluster:
            spark_version: "13.3.x-scala2.12"
            node_type_id: "i3.xlarge"
            num_workers: 2
            spark_conf:
              "spark.databricks.delta.preview.enabled": "true"
        
        - task_key: "model_training"
          depends_on:
            - task_key: "data_preprocessing"
          notebook_task:
            notebook_path: "./notebooks/02_model_training"
            base_parameters:
              catalog_name: "{{var.catalog_name}}"
              schema_name: "{{var.schema_name}}"
              model_name: "{{var.model_name}}"
              experiment_name: "{{var.experiment_name}}"
          new_cluster:
            spark_version: "13.3.x-scala2.12"
            node_type_id: "i3.xlarge"
            num_workers: 2
            spark_conf:
              "spark.databricks.delta.preview.enabled": "true"
        
        - task_key: "model_deployment"
          depends_on:
            - task_key: "model_training"
          notebook_task:
            notebook_path: "./notebooks/03_model_deployment"
            base_parameters:
              catalog_name: "{{var.catalog_name}}"
              schema_name: "{{var.schema_name}}"
              model_name: "{{var.model_name}}"
          new_cluster:
            spark_version: "13.3.x-scala2.12"
            node_type_id: "i3.xlarge"
            num_workers: 1

  experiments:
    fraud_detection_experiment:
      name: "{{var.experiment_name}}"

  registered_models:
    fraud_detection_model:
      name: "{{var.catalog_name}}.{{var.schema_name}}.{{var.model_name}}"
      catalog_name: "{{var.catalog_name}}"
      schema_name: "{{var.schema_name}}"
